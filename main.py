import telebot as tb
from telebot import types
from functools import partial

bot=tb.TeleBot(token='7104012758:AAHPvjgf9XwTzRDg3lHuLO2qq0pbdfLC_28')


products={
    '–ö—Ä–∏–ø—Ç–æ-–ü–†–û':{'info':'–ö—Ä–∏–ø—Ç–æ–ü—Ä–æ ‚Äì —ç—Ç–æ –∫–æ–º–ø–∞–Ω–∏—è-–ª–∏–¥–µ—Ä –Ω–∞ —Ä—ã–Ω–∫–µ —Å—Ä–µ–¥—Å—Ç–≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ö—Ä–∏–ø—Ç–æ–ü—Ä–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –æ—Ä–≥–∞–Ω–∞–º–∏ –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–∞—Ö —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞.', 'price':'2300'},
    '1–°':{'info':'1–° - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ¬´1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ¬ª. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–Ω–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –∫–∞–∫ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –æ—Ö–≤–∞—Ç–∏–ª–∞ –º–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–ª–∞—Å—Å–æ–≤ ERP, CRM, HRM, SCM.', 'price':'8000'},
    '–≠–¶–ü':{'info':'–ß–µ–º —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –ª—É—á—à–µ –æ–±—ã—á–Ω–æ–π? \n –í—Å–µ–≥–¥–∞ –Ω–∞–π–¥—É—Ç—Å—è —Ç–µ, –∫—Ç–æ –Ω–µ –ø–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–æ –±–ª–∞–≥–æ, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã. \n –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ–º, –∑–∞—á–µ–º –Ω—É–∂–Ω–∞ —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –∏ —á–µ–º –æ–Ω–∞ –ª—É—á—à–µ —Ä—É—á–Ω–æ–π ‚§µÔ∏è \n –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–ª–æ–∂–Ω—ã–π –Ω–∞–±–æ—Ä –∑–Ω–∞–∫–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. \n ‚ö°Ô∏è –°–µ–≥–æ–¥–Ω—è –≠–¶–ü –ø—Ä–∏–∑–Ω–∞–Ω–∞ –ø–æ–ª–Ω—ã–º —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–æ–º —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏. \n –í —á–µ–º –∂–µ –µ–µ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ? \n 1‚É£ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å \n –í —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –æ–±—ã—á–Ω—É—é –ø–æ–¥–ø–∏—Å—å –º–æ–∂–Ω–æ –≤ –¥–≤–∞ —Å—á–µ—Ç–∞ —Ñ–∞–ª—å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∏–º–µ–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—Ç–µ–ø–µ–Ω—å –∑–∞—â–∏—Ç—ã. \n 2‚É£ –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ \n –ó–∞—è–≤–ª–µ–Ω–∏—è –≤ –≥–æ—Å–æ—Ä–≥–∞–Ω—ã –≤ –æ–¥–∏–Ω –∫–ª–∏–∫ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ –≤–º–µ—Å—Ç–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏. \n üí° –ö—Ä–æ–º–µ —Ç–æ–≥–æ, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –¥–µ–Ω—å–≥–∏ –Ω–∞ –±—É–º–∞–≥—É –∏ –ø–æ—á—Ç–æ–≤—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.‚†Ä \n 3‚É£ –î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º —Ç–æ—Ä–≥–∞–º \n –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–µ–Ω–¥–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–∞–Ω–∏—è–º-–æ–±–ª–∞–¥–∞—Ç–µ–ª—è–º –≠–¶–ü. –¥–∞–ª–µ–µ –≤–æ–ø—Ä–æ—Å: —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –¶–∏—Ñ—Ä–æ–≤—É—é –ü–æ–¥–ø–∏—Å—å.', 'price':'3000'},
    '–ß–∞—Ç-–±–æ—Ç':{'info':'–ß–∞—Ç-–±–æ—Ç –æ—Ç ITINS ‚Äì —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞\n –¢—Ä—É–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, —Å–∫—Ä—É–ø—É–ª–µ–∑–Ω–æ —Å–ª–µ–¥—è—â–∏—Ö –∑–∞ —É—Ä–æ–≤–Ω–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ–º –Ω–∞—Å—É—â–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –æ–±–ª–µ–≥—á–∞—é—Ç —á–∞—Ç-–±–æ—Ç—ã.\n üí° –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á–µ–∫ –∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.\n –ê —á—Ç–æ –µ—â–µ –æ–Ω –º–æ–∂–µ—Ç?\n ‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–Ω–ª–∞–π–Ω-–∑–∞–∫–∞–∑—ã.\n ‚úÖ –ü–æ–¥–±–∏—Ä–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n ‚úÖ –°–æ–±–∏—Ä–∞—Ç—å –±–æ–ª—å—à–∏–µ –º–∞—Å—Å–∏–≤—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.\n ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, —Å–Ω–∏–∂–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n –ß–∞—Ç-–±–æ—Ç –≤ Telegram –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –±—ã—Ç—å –±–ª–∏–∂–µ –∫ –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª –æ—Ç –±–æ–ª–µ–µ –≤–∞–∂–Ω–æ–π –∏ —Å–ª–æ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã.\n üìà–°–æ –≤—Ä–µ–º–µ–Ω–µ–º —Ä–æ–±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–≤—ã—Å–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é –ø–ª–∞–Ω–∫—É, –Ω–æ –∏ –≤—ã–¥–µ–ª–∏—Ç—å—Å—è –∫–∞—á–µ—Å—Ç–≤–æ–º —Å–µ—Ä–≤–∏—Å–∞ —Å—Ä–µ–¥–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤.\n –ö–æ–º–∞–Ω–¥–∞ ITINS –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Å–æ–∑–¥–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É–º–Ω–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞ —Ç–∞–∫, —á—Ç–æ–±—ã –±–∏–∑–Ω–µ—Å —É–≤–µ—Ä–µ–Ω–Ω–æ —à–∞–≥–∞–ª –≤ –≥–æ—Ä—É!', 'price':'10000'}
    }

@bot.message_handler(commands=['start'])
def start(message):
    #bot.send_message(message.chat.id, '',reply_markup=types.ReplyKeyboardRemove())
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn1 = types.KeyboardButton("‚ùì –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å")
    btn2 = types.KeyboardButton("üõà –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ")
    markup.add(btn1, btn2)
    
    bot.send_message(message.chat.id, text="{0.first_name}!\n –ß–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?".format(message.from_user), reply_markup=markup)
    
    bot.register_next_step_handler(message, step_1)


def step_1(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    
    if message.text == "üõà –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ":
        bot.send_message(message.chat.id, 
                         text="–≠—Ç–æ –±–æ—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è –ø–æ–º–æ—â–∏ –Ω–∞—à–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º. –û–Ω –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–∏–ø–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º", 
                         reply_markup=markup.add(types.KeyboardButton("–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")))
        
        bot.register_next_step_handler(message, start)
        
        
    elif message.text == "‚ùì –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å":
        #bot.send_message(message.chat.id, '',reply_markup=types.ReplyKeyboardRemove())
        product_change(message,markup)
    
    else:
        bot.send_message(message.chat.id, text="–ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")
        bot.register_next_step_handler(message, step_1)
                
        
        
        
def product_change(message,markup=None):
    if markup==None:
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
  
    for product in list(products.keys()):
        markup.add(types.KeyboardButton(product))
        
    markup.add(types.KeyboardButton("–î—Ä—É–≥–æ–µ"))
    
    bot.send_message(message.chat.id, text="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –≤–æ–ø—Ä–æ—Å–∞", reply_markup=markup)
    
    bot.register_next_step_handler(message, step_2)
    
    
    
def step_2(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    
    if  message.text=='/start':
        start(message)
        
    elif message.text=='–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é':
        bot.register_next_step_handler(message, start)
    
    elif message.text=='–î—Ä—É–≥–æ–µ':
          operator(message)
    
    elif message.text not in list(products.keys()):
        bot.send_message(message.chat.id, text="–£ –Ω–∞—Å –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.\n–ï—Å–ª–∏ —Ç–µ–º—ã –≤–∞—à–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, —Ç–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <–î—Ä—É–≥–æ–µ>")   
        product_change(message,markup)
        
    else:
        product=message.text
        product_actions(message, product)


def product_actions(message, product, markup=None, change=None):
    
    if markup==None:
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        
    actions=["–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ", "–ü—Ä–∞–π—Å", "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"]
    
    if change:
        actions.remove(change)
        text="–ß—Ç–æ –≤–∞—Å –µ—â—ë –∏–Ω—Ç–µ—Ä—Å—É–µ—Ç?"
    else:
        text="–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä—Å—É–µ—Ç?"

    for action in actions:
        markup.add(types.KeyboardButton(action))

    markup.add(types.KeyboardButton("–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"))

    bot.send_message(message.chat.id, text=text, reply_markup=markup)

    bot.register_next_step_handler(message, partial(step_3, product=product))
    
    
    
def step_3(message, product):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)

    if  message.text=='/start' or message.text=='–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é':
        start(message)
        
    elif message.text=="–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è":
        operator(message, product=product)
           
    elif message.text not in ['–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ','–ü—Ä–∞–π—Å']: 
        bot.send_message(message.chat.id, text=f"–Ø –≤–∞—Å –Ω–µ –ø–æ–Ω–∏–º–∞—é. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö")
        product_actions(message, product, markup)
        
    else: 
        if message.text=='–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ':
            bot.send_message(message.chat.id, text=products[product]['info'])

        elif message.text=='–ü—Ä–∞–π—Å':
            bot.send_message(message.chat.id, text=products[product]['price'])

        product_actions(message, product, markup, message.text)


                
def operator(message, product=None):
    ##markup1 = types.ReplyKeyboardMarkup(resize_keyboard=True).add(types.KeyboardButton("–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"))
    markup = types.InlineKeyboardMarkup().add(types.InlineKeyboardButton("–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏", url='https://t.me/ITINS_sup_bot'))          

    if product:
        
        bot.send_message(message.chat.id, text=f"–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ {product} –≤ —ç—Ç–æ—Ç —á–∞—Ç",reply_markup=markup)
    
    else:
        bot.send_message(message.chat.id, text=f"–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –≤ —ç—Ç–æ—Ç —á–∞—Ç",reply_markup=markup)
        
    start(message)
 
bot.infinity_polling(none_stop=True)
